---
title: "P8105 Homework 4"
author: "Laylah Jones"
date: 2023-11-15
output: github_document
---

```{r, include=FALSE}
library(tidyverse)
library(rvest)
library(readr)
library(broom)
library(dplyr)

options(readr.show_col_types = FALSE)

knitr::opts_chunk$set(
  fig.width = 8,
  fig.height = 6,
  out.width = "90%"
)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = ("viridis"))

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1



# Problem 2

## Load the data

```{r, col_types = FALSE}
study_df = 
  tibble(
    files = list.files("data/"),
    path = str_c("data/", files)) |> 
  mutate(data = map(path, read_csv)) |> 
  unnest(c(data))

study_df
```

## Tidy the data
```{r}
tidy_study_df = 
  study_df |> 
  separate(files, into = c("control_arm", "subject_ID", "csv")) |> 
  mutate(
    control_arm = ifelse(control_arm == "con", "control", control_arm),
    control_arm = ifelse(control_arm == "exp", "experimental", control_arm)
  ) |> 
  pivot_longer(
    cols = starts_with("week"), 
    names_to = "week", 
    names_prefix = "week_",
    values_to = "observation") |> 
  select(subject_ID, control_arm, week, observation) |> 
  mutate(week = as.numeric(week))

tidy_study_df
```


## Spaghetti Plot of Observations on Each Subject Over Time

```{r}
study_plot = 
  tidy_study_df |> 
  ggplot(aes(x = week, y = observation, color = subject_ID)) +
  geom_point() +
  geom_line() +
  facet_grid(.~control_arm) + 
  labs(
    x = "Week",
    y = "Observation",
    title = "Observations for Each Subject by Week"
  )

study_plot
```

From this plot, we can observe that the control arm had lower values than the experimental arm. The control arm has observations that are consistently between the range of approximately -2.17 and 4.26 for each subject in all eight weeks, with the lowest observation value of -2.17 in week six for subject 5 and the highest observation value of 4.26 in week five for subject 10. The experimental arm has observations that are consistently between the range of approximately -0.84 and 7.66 for each subject in all eight weeks, with the lowest observation value being in week one for subject 2 and the highest observation value being in week seven for subject 6.


# Problem 3

## Setting the Design Elements and Generating 5000 Datasets
```{r}
n = 30
sigma = 5
mu = 0
mus = c(0, 1, 2, 3, 4, 5, 6)
alpha = 0.05
set.seed(12345)


sim_mean_sd = function(n, mu, sigma) {
  
  sim_df = tibble(
    x = rnorm(n, mean = mu, sd = sigma),
  )
  
  sim_df |> 
    summarize(
      mu_hat = mean(x),
      sigma_hat = sd(x)
    )
}

t_test = function(n, mu, sigma) {
  sample = rnorm(n, mean = mu, sd = sigma)
  test_result = t.test(sample, mu = 0)
  broom::tidy(test_result)
}

results = 
  tibble(mu = numeric(), mu_hat = numeric(), p_value = numeric(), reject = logical())
```

```{r}
for (mu in mus) {
  for (i in 1:50) {
    sim_results = sim_mean_sd(n, mu, sigma)
    t_test_results = t_test(n, mu, sigma)
    results = results |>  
      add_row(mu = mu, 
              mu_hat = sim_results$mu_hat, 
              p_value = t_test_results$p.value, 
              reject = t_test_results$p.value < alpha)
  }
}

power_results = results |>  
  group_by(mu) |>  
  summarize(power = mean(reject), 
            avg_mu_hat = mean(mu_hat), 
            avg_mu_hat_rejected = mean(mu_hat[reject]))
```

## Plot Showing the Proportion of Times the Null was Rejected

```{r}
power_results |>  
  ggplot(aes(
    x = mu, 
    y = power)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Proportion of Times the Null Hypothesis was Rejected for Each Mu", 
    x = "True Value of Mu", 
    y = "Power")
```

From the plot, we can see that as the value of mu increases the proportion of times the null hypothesis was rejected also increased. When mu reaches a value of 5 and 6, the power is 1. This could be interpreted as a larger effect size leading to higher power, meaning a higher rejection rate. 


## Plot Comparing the Average Estimate and the True Value of Mu

```{r}

```



